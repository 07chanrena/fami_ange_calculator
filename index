<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãµãã¿ãƒ¼ã‚†/ã‚ã‚“ã˜ã‚…ãˆãƒ¼ã‚‹ å»¶é•·è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
  <style>
    body { font-family: 'Arial', sans-serif; padding: 20px; background-color: #f0f8ff; }
    select, input, button { margin: 10px 0; padding: 8px; width: 100%; max-width: 300px; font-size: 16px; }
    button { background-color: #ff69b4; color: white; border: none; cursor: pointer; }
    .output { margin-top: 20px; font-weight: bold; font-size: 18px; color: #333; }
    .output span { display: block; margin: 5px 0; }
    .error { color: red; }
    .green { color: green; }
  </style>
</head>
<body>
  <h2>ãµãã¿ãƒ¼ã‚†/ã‚ã‚“ã˜ã‚…ãˆãƒ¼ã‚‹ å»¶é•·è¨ˆç®—ã‚¢ãƒ—ãƒª</h2>

  <label>é¡§å®¢ç¨®åˆ¥</label>
  <select id="customer">
    <option value="watch">è¦³æˆ¦ãƒ‘ãƒƒã‚¯</option>
    <option value="normal">é€šå¸¸ã‚»ãƒƒãƒˆ</option>
  </select>

  <label>å…¥å ´æ™‚é–“ï¼ˆä¾‹: 19:00 ã¾ãŸã¯ 25:30ï¼‰</label>
  <input type="text" id="entryTime" value="19:00">

  <label>é€€åº—å¸Œæœ›æ™‚é–“</label>
  <input type="text" id="exitTime">

  <button onclick="calculate()">ç®—å‡ºã™ã‚‹</button>

  <div class="output" id="result"></div>

  <script>
    // ç¾åœ¨æ™‚åˆ»ã‚’é€€åº—å¸Œæœ›æ™‚åˆ»ã«ã‚»ãƒƒãƒˆã™ã‚‹
    function setDefaultExitTime() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      document.getElementById('exitTime').value = `${hours}:${minutes}`;
    }

    const customerOptions = {
      watch: { setTime: 120, drinkTime: '120åˆ†' },
      normal: { setTime: 40, drinkTime: '40åˆ†' }
    };

    function timeToMinutes(str) {
      const [h, m] = str.split(":").map(Number);
      return h * 60 + m;
    }

    function minutesToTime(min) {
      const h = Math.floor(min / 60) % 24;
      const m = min % 60;
      return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
    }

    function formatTimeDuration(min) {
      const h = Math.floor(min / 60);
      const m = min % 60;
      return `${h}æ™‚é–“${m}åˆ†`;
    }

    function calculate() {
      const customer = document.getElementById('customer').value;
      const entry = timeToMinutes(document.getElementById('entryTime').value);
      const exit = timeToMinutes(document.getElementById('exitTime').value);
      const result = document.getElementById('result');
      result.innerHTML = "";

      if (!customer || entry === null || exit === null) {
        result.innerHTML = "<span class='error'>å…¥åŠ›ã‚’ã™ã¹ã¦æ­£ã—ãæŒ‡å®šã—ã¦ãã ã•ã„ã€‚</span>";
        return;
      }
      if (exit <= entry) {
        result.innerHTML = "<span class='error'>é€€åº—å¸Œæœ›æ™‚é–“ã¯å…¥å ´æ™‚é–“ã‚ˆã‚Šå¾Œã«ã—ã¦ãã ã•ã„ã€‚</span>";
        return;
      }

      const setTime = customerOptions[customer].setTime;
      const unit = 10;
      const totalStay = exit - entry;
      const extra = Math.max(0, totalStay - setTime);
      const count = (extra <= 0) ? 0 : Math.ceil(extra / unit);

      const nowEnd = entry + setTime + count * unit;
      const nextEnd = nowEnd + unit;

      let output = `
        âœ… ç¾åœ¨ã¾ã§ã®æ»åœ¨æ™‚é–“ï¼š${formatTimeDuration(totalStay)}<br>
        ğŸ¹ é£²ã¿æ”¾é¡Œã®æ™‚é–“ï¼š${customerOptions[customer].drinkTime}<br><br>
      `;

      if (count === 0) {
        output += `<span class="green">ğŸŸ¢ ã‚»ãƒƒãƒˆå†…ã§å®Œçµã—ã¦ã„ã¾ã™ã€‚å»¶é•·ã¯ä¸è¦ã§ã™ã€‚</span>`;
      } else {
        output += `
          ğŸ” ç¾åœ¨ã¾ã§ã®å»¶é•·å›æ•°ï¼š${count}å›<br>
          â±ï¸ å»¶é•·åˆ†æ•°ï¼š${extra}åˆ†<br>
          ğŸ•‘ ç¾åœ¨ã®å»¶é•·çµ‚äº†æ™‚åˆ»ï¼š${minutesToTime(nowEnd)}<br>
          â• å»¶é•·ã‚’1è¿½åŠ ã—ãŸå ´åˆï¼š${minutesToTime(nextEnd)}<br>
        `;
      }

      result.innerHTML = output;
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«é€€åº—å¸Œæœ›æ™‚é–“ã‚’ã‚»ãƒƒãƒˆ
    window.onload = setDefaultExitTime;
  </script>
</body>
</html>
